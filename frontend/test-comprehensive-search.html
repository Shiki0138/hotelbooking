<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>åŒ…æ‹¬çš„æ¤œç´¢ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        input { width: 70%; padding: 10px; margin: 10px 0; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
        .result { margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 5px; }
        .hotel { padding: 10px; margin: 5px 0; background: white; border-radius: 5px; border: 1px solid #dee2e6; }
        .error { background: #f8d7da; color: #721c24; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ åŒ…æ‹¬çš„ãƒ›ãƒ†ãƒ«æ¤œç´¢ãƒ†ã‚¹ãƒˆ</h1>
        <p>æ¥½å¤©APIã¨ãƒ­ãƒ¼ã‚«ãƒ«DBã®ä¸¡æ–¹ã‹ã‚‰æ¤œç´¢çµæœã‚’å–å¾—ã—ã¾ã™ã€‚</p>
        
        <input type="text" id="query" placeholder="ãƒ›ãƒ†ãƒ«åã‚’å…¥åŠ›ï¼ˆä¾‹: æµ¦å³¶ï¼‰" value="æµ¦å³¶">
        <button onclick="testSearch()">æ¤œç´¢</button>
        
        <div id="result"></div>
    </div>

    <script>
        const RAKUTEN_API_KEY = '1024978400665725396';
        
        async function testSearch() {
            const query = document.getElementById('query').value;
            const resultDiv = document.getElementById('result');
            
            resultDiv.innerHTML = 'ğŸ”„ æ¤œç´¢ä¸­...';
            
            try {
                // æ¥½å¤©APIã‹ã‚‰æ¤œç´¢
                const rakutenResults = await searchRakutenAPI(query);
                
                // ãƒ­ãƒ¼ã‚«ãƒ«DBã‹ã‚‰æ¤œç´¢ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
                const localResults = searchLocalDB(query);
                
                // çµæœã‚’è¡¨ç¤º
                let html = '<h3>æ¤œç´¢çµæœ:</h3>';
                
                html += '<h4>æ¥½å¤©APIçµæœ (' + rakutenResults.length + 'ä»¶):</h4>';
                if (rakutenResults.length > 0) {
                    rakutenResults.forEach(hotel => {
                        html += `<div class="hotel">
                            <strong>${hotel.name}</strong><br>
                            ğŸ“ ${hotel.address}<br>
                            ğŸ’° æœ€ä½æ–™é‡‘: Â¥${hotel.price ? hotel.price.toLocaleString() : 'æœªè¨­å®š'}
                        </div>`;
                    });
                } else {
                    html += '<p>æ¥½å¤©APIã‹ã‚‰çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
                }
                
                html += '<h4>ãƒ­ãƒ¼ã‚«ãƒ«DBçµæœ (' + localResults.length + 'ä»¶):</h4>';
                localResults.forEach(hotel => {
                    html += `<div class="hotel">
                        <strong>${hotel.name}</strong><br>
                        ğŸ“ ${hotel.location}
                    </div>`;
                });
                
                resultDiv.innerHTML = html;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }
        
        async function searchRakutenAPI(query) {
            return new Promise((resolve, reject) => {
                const callbackName = 'callback' + Date.now();
                window[callbackName] = (data) => {
                    delete window[callbackName];
                    document.head.removeChild(script);
                    
                    if (data.error) {
                        reject(new Error(data.error));
                        return;
                    }
                    
                    const hotels = data.hotels ? data.hotels.map(h => ({
                        name: h.hotel[0].hotelBasicInfo.hotelName,
                        address: h.hotel[0].hotelBasicInfo.address1 + h.hotel[0].hotelBasicInfo.address2,
                        price: h.hotel[0].hotelBasicInfo.hotelMinCharge
                    })) : [];
                    
                    resolve(hotels);
                };
                
                const params = new URLSearchParams({
                    format: 'json',
                    keyword: query,
                    applicationId: RAKUTEN_API_KEY,
                    hits: '10'
                });
                
                const script = document.createElement('script');
                script.src = `https://app.rakuten.co.jp/services/api/Travel/KeywordHotelSearch/20170426?${params}&callback=${callbackName}`;
                script.onerror = () => {
                    delete window[callbackName];
                    reject(new Error('APIå‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼'));
                };
                
                document.head.appendChild(script);
                
                setTimeout(() => {
                    if (window[callbackName]) {
                        delete window[callbackName];
                        document.head.removeChild(script);
                        reject(new Error('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ'));
                    }
                }, 10000);
            });
        }
        
        function searchLocalDB(query) {
            // ãƒ­ãƒ¼ã‚«ãƒ«DBã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            const localHotels = [
                { name: 'æµ¦å³¶ãƒ›ãƒ†ãƒ«', location: 'å’Œæ­Œå±±çœŒ æ±ç‰Ÿå©éƒ¡' },
                { name: 'ãƒ›ãƒ†ãƒ«æµ¦å³¶', location: 'é™å²¡çœŒ è³€èŒ‚éƒ¡' },
                { name: 'æµ¦å³¶æ¸©æ³‰', location: 'åŒ—æµ·é“ å‡½é¤¨å¸‚' }
            ];
            
            return localHotels.filter(hotel => 
                hotel.name.toLowerCase().includes(query.toLowerCase())
            );
        }
        
        // è‡ªå‹•å®Ÿè¡Œ
        window.onload = () => testSearch();
    </script>
</body>
</html>