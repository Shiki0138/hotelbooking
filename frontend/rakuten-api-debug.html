<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¥½å¤©API ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        .debug-section { background: #f8f9fa; padding: 20px; margin: 20px 0; border-radius: 8px; }
        input[type="text"] { width: 70%; padding: 10px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .result { background: #d4edda; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #28a745; }
        .error { background: #f8d7da; color: #721c24; border-left: 4px solid #dc3545; }
        .code { background: #f8f9fa; padding: 10px; font-family: monospace; border-radius: 4px; border: 1px solid #e9ecef; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ æ¥½å¤©API ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>
        
        <div class="debug-section">
            <h3>1. APIã‚­ãƒ¼ç¢ºèª</h3>
            <input type="text" id="apiKey" placeholder="æ¥½å¤©ã‚¢ãƒ—ãƒªID" value="1024978400665725396" />
            <button onclick="testApiKey()">APIã‚­ãƒ¼ãƒ†ã‚¹ãƒˆ</button>
            <div id="apiKeyResult"></div>
        </div>
        
        <div class="debug-section">
            <h3>2. URLæ§‹ç¯‰ãƒ†ã‚¹ãƒˆ</h3>
            <input type="text" id="testKeyword" placeholder="æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰" value="æ±äº¬" />
            <button onclick="buildTestUrl()">URLæ§‹ç¯‰</button>
            <div id="urlResult"></div>
        </div>
        
        <div class="debug-section">
            <h3>3. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆ</h3>
            <button onclick="testMinimalParams()">æœ€å°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆ</button>
            <button onclick="testDifferentApproach()">åˆ¥ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãƒ†ã‚¹ãƒˆ</button>
            <div id="paramResult"></div>
        </div>
        
        <div class="debug-section">
            <h3>4. ã‚¨ãƒ©ãƒ¼è©³ç´°</h3>
            <div id="errorDetails"></div>
        </div>
    </div>

    <script>
        async function testApiKey() {
            const apiKey = document.getElementById('apiKey').value;
            const resultDiv = document.getElementById('apiKeyResult');
            
            if (!apiKey) {
                resultDiv.innerHTML = '<div class="error">APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>';
                return;
            }
            
            resultDiv.innerHTML = '<div>ğŸ”„ APIã‚­ãƒ¼ã‚’ãƒ†ã‚¹ãƒˆä¸­...</div>';
            
            // æ¥½å¤©Books APIã§ç°¡å˜ãƒ†ã‚¹ãƒˆï¼ˆHotelAPIã‚ˆã‚Šåˆ¶é™ãŒå°‘ãªã„ï¼‰
            try {
                const testUrl = `https://app.rakuten.co.jp/services/api/BooksBook/Search/20170404?format=json&title=æ±äº¬&applicationId=${apiKey}&callback=testCallback`;
                
                await new Promise((resolve, reject) => {
                    window.testCallback = function(data) {
                        delete window.testCallback;
                        
                        if (data.error) {
                            resultDiv.innerHTML = `<div class="error">âŒ APIã‚­ãƒ¼ã‚¨ãƒ©ãƒ¼: ${data.error}<br>è©³ç´°: ${data.error_description}</div>`;
                        } else {
                            resultDiv.innerHTML = '<div class="result">âœ… APIã‚­ãƒ¼ã¯æœ‰åŠ¹ã§ã™ï¼</div>';
                        }
                        resolve();
                    };
                    
                    const script = document.createElement('script');
                    script.src = testUrl;
                    script.onerror = () => reject(new Error('ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼'));
                    document.head.appendChild(script);
                    
                    setTimeout(() => {
                        if (window.testCallback) {
                            delete window.testCallback;
                            document.head.removeChild(script);
                            reject(new Error('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ'));
                        }
                    }, 5000);
                });
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }
        
        function buildTestUrl() {
            const apiKey = document.getElementById('apiKey').value;
            const keyword = document.getElementById('testKeyword').value;
            const resultDiv = document.getElementById('urlResult');
            
            const params = new URLSearchParams({
                format: 'json',
                keyword: keyword,
                applicationId: apiKey,
                hits: '3'
            });
            
            const fullUrl = `https://app.rakuten.co.jp/services/api/Travel/HotelSearch/20131024?${params.toString()}`;
            
            resultDiv.innerHTML = `
                <div class="result">
                    <strong>æ§‹ç¯‰ã•ã‚ŒãŸURL:</strong><br>
                    <div class="code">${fullUrl}</div>
                    <br>
                    <button onclick="testThisUrl('${fullUrl}')">ã“ã®URLã‚’ãƒ†ã‚¹ãƒˆ</button>
                </div>
            `;
        }
        
        async function testThisUrl(url) {
            const resultDiv = document.getElementById('urlResult');
            resultDiv.innerHTML += '<div>ğŸ”„ URLã‚’ãƒ†ã‚¹ãƒˆä¸­...</div>';
            
            try {
                const callbackName = 'urlTestCallback' + Date.now();
                const urlWithCallback = url + `&callback=${callbackName}`;
                
                await new Promise((resolve, reject) => {
                    window[callbackName] = function(data) {
                        delete window[callbackName];
                        
                        if (data.error) {
                            resultDiv.innerHTML += `<div class="error">âŒ ã‚¨ãƒ©ãƒ¼: ${data.error} - ${data.error_description}</div>`;
                        } else {
                            const hotelCount = data.hotels ? data.hotels.length : 0;
                            resultDiv.innerHTML += `<div class="result">âœ… æˆåŠŸï¼ ${hotelCount}è»’ã®ãƒ›ãƒ†ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ</div>`;
                        }
                        resolve();
                    };
                    
                    const script = document.createElement('script');
                    script.src = urlWithCallback;
                    script.onerror = () => reject(new Error('ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼'));
                    document.head.appendChild(script);
                    
                    setTimeout(() => {
                        if (window[callbackName]) {
                            delete window[callbackName];
                            document.head.removeChild(script);
                            reject(new Error('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ'));
                        }
                    }, 10000);
                });
            } catch (error) {
                resultDiv.innerHTML += `<div class="error">âŒ ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }
        
        async function testMinimalParams() {
            const apiKey = document.getElementById('apiKey').value;
            const resultDiv = document.getElementById('paramResult');
            
            resultDiv.innerHTML = '<div>ğŸ”„ æœ€å°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ãƒ†ã‚¹ãƒˆä¸­...</div>';
            
            // æœ€å°é™ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ãƒ†ã‚¹ãƒˆ
            const minimalParams = new URLSearchParams({
                format: 'json',
                applicationId: apiKey,
                largeClassCode: '11', // åŒ—æµ·é“
                callback: 'minimalTest'
            });
            
            const url = `https://app.rakuten.co.jp/services/api/Travel/HotelSearch/20131024?${minimalParams.toString()}`;
            
            try {
                await new Promise((resolve, reject) => {
                    window.minimalTest = function(data) {
                        delete window.minimalTest;
                        
                        if (data.error) {
                            resultDiv.innerHTML = `<div class="error">âŒ æœ€å°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã‚‚ã‚¨ãƒ©ãƒ¼: ${data.error} - ${data.error_description}</div>`;
                        } else {
                            const hotelCount = data.hotels ? data.hotels.length : 0;
                            resultDiv.innerHTML = `<div class="result">âœ… æœ€å°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æˆåŠŸï¼ ${hotelCount}è»’ã®ãƒ›ãƒ†ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ</div>`;
                        }
                        resolve();
                    };
                    
                    const script = document.createElement('script');
                    script.src = url;
                    document.head.appendChild(script);
                    
                    setTimeout(() => {
                        if (window.minimalTest) {
                            delete window.minimalTest;
                            document.head.removeChild(script);
                            reject(new Error('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ'));
                        }
                    }, 10000);
                });
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }
        
        function testDifferentApproach() {
            const apiKey = document.getElementById('apiKey').value;
            const resultDiv = document.getElementById('paramResult');
            
            resultDiv.innerHTML += `
                <div class="debug-section">
                    <h4>ğŸ“‹ ãƒ‡ãƒãƒƒã‚°æƒ…å ±</h4>
                    <div class="code">
                        APIã‚­ãƒ¼: ${apiKey}<br>
                        APIã‚­ãƒ¼æ–‡å­—æ•°: ${apiKey.length}<br>
                        APIã‚­ãƒ¼ã‚¿ã‚¤ãƒ—: ${typeof apiKey}<br>
                        APIã‚­ãƒ¼å½¢å¼ãƒã‚§ãƒƒã‚¯: ${/^\d+$/.test(apiKey) ? 'âœ… æ•°å­—ã®ã¿' : 'âŒ æ•°å­—ä»¥å¤–ãŒå«ã¾ã‚Œã¦ã„ã‚‹'}
                    </div>
                    
                    <h4>ğŸ”— æ¥½å¤©ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒ“ã‚¹ç¢ºèªäº‹é …</h4>
                    <div class="code">
                        1. <a href="https://webservice.rakuten.co.jp/" target="_blank">æ¥½å¤©ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒ“ã‚¹</a>ã«ãƒ­ã‚°ã‚¤ãƒ³<br>
                        2. ã‚¢ãƒ—ãƒªä¸€è¦§ã§ã‚¢ãƒ—ãƒªIDã‚’ç¢ºèª<br>
                        3. ã‚¢ãƒ—ãƒªã®åˆ©ç”¨å¯èƒ½APIä¸€è¦§ã§ã€Œæ¥½å¤©ãƒˆãƒ©ãƒ™ãƒ«ã€ãŒæœ‰åŠ¹ã‹ç¢ºèª<br>
                        4. ã‚¢ãƒ—ãƒªã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒã€Œæœ‰åŠ¹ã€ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª
                    </div>
                </div>
            `;
        }
        
        // ã‚¨ãƒ©ãƒ¼è©³ç´°è¡¨ç¤º
        document.getElementById('errorDetails').innerHTML = `
            <div class="error">
                <h4>âŒ ç¾åœ¨ã®ã‚¨ãƒ©ãƒ¼çŠ¶æ³</h4>
                <p><strong>ã‚¨ãƒ©ãƒ¼:</strong> wrong_parameter</p>
                <p><strong>è€ƒãˆã‚‰ã‚Œã‚‹åŸå› :</strong></p>
                <ul>
                    <li>APIã‚­ãƒ¼ (applicationId) ãŒç„¡åŠ¹</li>
                    <li>APIã‚­ãƒ¼ã®å½¢å¼ãŒé–“é•ã£ã¦ã„ã‚‹</li>
                    <li>ã‚¢ãƒ—ãƒªãŒæ¥½å¤©ãƒˆãƒ©ãƒ™ãƒ«APIã®åˆ©ç”¨è¨±å¯ã‚’å¾—ã¦ã„ãªã„</li>
                    <li>ã‚¢ãƒ—ãƒªãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹</li>
                    <li>å¿…è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã‚‹</li>
                </ul>
                
                <h4>ğŸ”§ è§£æ±ºæ‰‹é †</h4>
                <ol>
                    <li>ä¸Šè¨˜ã®ã€ŒAPIã‚­ãƒ¼ãƒ†ã‚¹ãƒˆã€ã‚’å®Ÿè¡Œ</li>
                    <li>æ¥½å¤©ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚¢ãƒ—ãƒªè¨­å®šã‚’ç¢ºèª</li>
                    <li>æ–°ã—ã„ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¦APIã‚­ãƒ¼ã‚’å†å–å¾—</li>
                </ol>
            </div>
        `;
    </script>
</body>
</html>