# 🚀 LastMinuteStay 新機能実装計画

## 📊 実装状況サマリー

### ✅ 既存機能（実装済み）
- **認証・予約・決済**: 完全動作
- **AI検索**: 自然言語、画像、音声検索実装済み
- **通知基盤**: メール、SMS、プッシュ、LINE対応（バックエンド完成）
- **お気に入り・レビュー**: 実装済み
- **多言語対応**: 日英対応済み

### 🎯 新機能実装計画

## Phase 1: 即座に価値提供（1-2週間）

### 1. ウォッチリスト＋マルチチャネル通知 🔔

#### 実装内容
```typescript
// 新規追加機能
- 価格閾値設定（◯円以下、△％OFF）
- 曜日指定（週末のみ通知など）
- 通知チャネル選択（メール/LINE/SMS/プッシュ）
- 残室数アラート
- iCalカレンダー連携
```

#### 技術実装
- **データベース**: ✅ watchlist_schema.sql 作成済み
- **バックエンド**: 
  - 価格監視Cronジョブ（1時間ごと）
  - 既存通知システムの活用
- **フロントエンド**:
  - ウォッチリスト管理画面
  - 通知設定モーダル

### 2. セグメント別おすすめホテル 👨‍👩‍👧‍👦

#### セグメント定義
```javascript
const segments = {
  single: "独身・一人旅",
  couple: "カップル",
  family_young: "子連れファミリー（小学生以下）",
  family_teen: "子連れファミリー（中高生）", 
  senior_couple: "熟年夫婦",
  business: "ビジネス",
  group: "グループ・友人"
};
```

#### 実装内容
- プロフィール入力 or LINE連携でセグメント自動判定
- セグメント×旅行目的でレコメンドスコア計算
- 「あなた向け」バッジと理由タグ表示

## Phase 2: 競争優位性構築（2-4週間）

### 3. 価格予測＆予約タイミング提案 📊

#### ML実装
```python
# backend/services/price_prediction_service.py
- XGBoostモデル
- 特徴量: 曜日、季節、イベント、過去価格
- 7日間の価格推移予測
- 信頼度スコア（★1-3）
```

#### UI表示
- 価格推移グラフ
- 「今買うべき」「待つべき」インジケーター
- ワンタップでウォッチリスト登録

### 4. SNS口コミハブ 📱

#### API統合
```javascript
// 3つの外部API統合
- Google Places API: レビューと評価
- Instagram Graph API: #ホテル名の投稿
- YouTube Data API: レビュー動画
```

#### キャッシュ戦略
- 24時間キャッシュ
- ホテル詳細ページにタブ表示
- レイジーローディング

## Phase 3: イノベーション機能（4-6週間）

### 5. オートブック／プライスフリーズ 🔒

#### オートブック
- 条件マッチで自動予約
- 事前クレカ認証
- 確認メール即時送信

#### プライスフリーズ
```typescript
// 価格固定ロジック
- 最大72時間の価格固定
- フリーズ手数料: ¥300-500
- 値上がり時の差額補填
- 残室数可視化
```

## 🛠️ 技術スタック活用

### 既存インフラの最大活用
- **Supabase**: リアルタイムDB + 認証
- **Redis**: 価格監視キャッシュ
- **Stripe**: 決済・与信処理
- **SendGrid/Twilio**: 通知配信
- **Vercel**: エッジ関数でML推論

### 新規追加
- **Python ML API**: FastAPI + XGBoost
- **外部API**: Google/Instagram/YouTube
- **Cron**: Vercel Cron or GitHub Actions

## 📅 実装スケジュール

### Week 1-2
- [x] データベーススキーマ作成
- [ ] ウォッチリスト バックエンドAPI
- [ ] ウォッチリスト フロントエンドUI
- [ ] セグメント判定ロジック

### Week 3-4
- [ ] 価格予測モデル構築
- [ ] 予測API実装
- [ ] SNS API統合
- [ ] キャッシュ実装

### Week 5-6
- [ ] オートブック エンジン
- [ ] プライスフリーズ 決済フロー
- [ ] 統合テスト
- [ ] 本番デプロイ

## 🎯 成功指標

### KPI
- ウォッチリスト登録率: 30%
- 通知からの予約転換率: 15%
- セグメントマッチ精度: 80%
- 価格予測精度: 75%
- プライスフリーズ利用率: 10%

### ユーザー価値
- 🎯 パーソナライズされた体験
- 💰 最適価格での予約
- ⏰ 時間の節約
- 📱 マルチチャネル対応
- 🔒 価格保証の安心感

## 🚦 リスクと対策

### 技術的リスク
- **ML精度**: 初期は「参考値」として表示
- **API制限**: キャッシュとレート制限実装
- **通知過多**: ユーザー設定で頻度調整

### ビジネスリスク
- **プライスフリーズ損失**: 手数料でヘッジ
- **自動予約ミス**: 承認フロー追加オプション

## 🎉 期待される成果

1. **差別化**: 競合にない独自機能
2. **エンゲージメント向上**: 定期的なサイト訪問
3. **予約率向上**: タイミング最適化
4. **顧客満足度**: パーソナライズ体験

---

**次のステップ**: Week 1-2の実装開始
- ウォッチリストAPIの実装
- フロントエンドUIの構築